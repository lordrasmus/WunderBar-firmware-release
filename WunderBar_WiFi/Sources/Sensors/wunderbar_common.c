
#include "wunderbar_common.h"


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/**@brief Extern variables. */

extern const uint8_t  SENSORS_DEVICE_NAME[NUMBER_OF_SENSORS][BLE_DEVNAME_MAX_LEN + 1];
extern const uint16_t SENSOR_CHAR_UUIDS[NUMBER_OF_RELAYR_CHARACTERISTICS + 1];

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static uint8_t sensors_get_threshold_size(data_id_t sens_name)
{
		switch (sens_name)
		{
		case DATA_ID_DEV_HTU :
				return (sizeof(sensor_htu_threshold_t));

		case DATA_ID_DEV_GYRO :
				return (sizeof(sensor_gyro_threshold_t));

		case DATA_ID_DEV_LIGHT :
				return (sizeof(sensor_lightprox_threshold_t));

		case DATA_ID_DEV_SOUND :
				return (sizeof(sensor_microphone_threshold_t));

		case DATA_ID_DEV_BRIDGE :
		case DATA_ID_DEV_IR :
		default :
				return 0;
		}
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static uint8_t sensors_get_config_size(data_id_t sens_name)
{
		switch (sens_name)
		{
		case DATA_ID_DEV_HTU :
				return (sizeof(sensor_htu_config_t));

		case DATA_ID_DEV_GYRO :
				return (sizeof(sensor_gyro_config_t));

		case DATA_ID_DEV_LIGHT :
				return (sizeof(sensor_lightprox_config_t));

	    case DATA_ID_DEV_BRIDGE :
	    		return (sizeof(sensor_bridge_config_t));

	    case DATA_ID_DEV_SOUND :
		case DATA_ID_DEV_IR :
		default :
				return 0;
		}
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static uint8_t sensors_get_data_size(data_id_t sens_name)
{
		switch (sens_name)
		{
		case DATA_ID_DEV_HTU :
				return (sizeof(sensor_htu_data_t));

		case DATA_ID_DEV_GYRO :
				return (sizeof(sensor_gyro_data_t));

		case DATA_ID_DEV_LIGHT :
				return (sizeof(sensor_lightprox_data_t));

		case DATA_ID_DEV_SOUND :
				return (sizeof(sensor_microphone_data_t));

		case DATA_ID_DEV_BRIDGE :
				return (sizeof(sensor_bridge_data_t));

		case DATA_ID_DEV_IR :
				return (sizeof(uint8_t));

		default :
				return 0;
		}
}


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


uint8_t sensors_get_cfg_size(field_id_config_t cfg_type)
{
	switch (cfg_type)
	{
		case FIELD_ID_CONFIG_HTU_PASS :
			return 7;
		case FIELD_ID_CONFIG_GYRO_PASS :
			return 7;
		case FIELD_ID_CONFIG_LIGHT_PASS :
			return 7;
		case FIELD_ID_CONFIG_SOUND_PASS :
			return 7;
		case FIELD_ID_CONFIG_BRIDGE_PASS :
			return 7;
		case FIELD_ID_CONFIG_IR_PASS :
			return 7;

		case FIELD_ID_CONFIG_WIFI_SSID :
			return 20;
		case FIELD_ID_CONFIG_WIFI_PASS :
			return 20;
		case FIELD_ID_CONFIG_MASTER_MODULE_SEC :
			return 20;

		case FIELD_ID_CONFIG_MASTER_MODULE_ID :
			return 16;

		case FIELD_ID_CONFIG_MASTER_MODULE_URL :
			return 12;

		default :
			return 0;
	}
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

uint8_t sensors_get_msg_size(data_id_t sens_name, field_id_char_index_t msg_type)
{

		if (sens_name == DATA_ID_CONFIG)
		{
			return sensors_get_cfg_size((field_id_config_t) msg_type);
		}

		switch (msg_type)
		{
		
		case FIELD_ID_CHAR_SENSOR_ID:
				return (sizeof(sensorID_t));

		case FIELD_ID_CHAR_SENSOR_BEACON_FREQUENCY:
				return (sizeof(beaconFrequency_t));

		case FIELD_ID_CHAR_SENSOR_FREQUENCY:
				return (sizeof(frequency_t));
	  
		case FIELD_ID_CHAR_SENSOR_LED_STATE:
				return (sizeof(led_state_t));

		case FIELD_ID_CHAR_SENSOR_THRESHOLD:
				return (sensors_get_threshold_size(sens_name));
		
		case FIELD_ID_CHAR_SENSOR_CONFIG:
				return (sensors_get_config_size(sens_name));

		case FIELD_ID_CHAR_SENSOR_DATA_R:
				return (sensors_get_data_size(sens_name));

		case FIELD_ID_CHAR_SENSOR_DATA_W:
				return (sensors_get_data_size(sens_name));
		
		case FIELD_ID_CHAR_BATTERY_LEVEL:
				return (1);
		
		case FIELD_ID_SENSOR_STATUS :
				return (16);

		case FIELD_ID_CHAR_FIRMWARE_REVISION :
			 	return (20);

		case FIELD_ID_CHAR_HARDWARE_REVISION :
			 	return (20);


		default :
				return 0;
		}
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

uint8_t sensor_get_name_index(const uint8_t * device_name)
{
		data_id_t cnt;
		for(cnt = DATA_ID_DEV_HTU; cnt <= DATA_ID_DEV_CFG_APP; cnt++)
		{
				if(device_name == SENSORS_DEVICE_NAME[cnt])
				{
						return (uint8_t)cnt;
				}
		}
		return 0xFF;
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

uint8_t sensor_get_char_index(uint16_t char_uuid)
{
		field_id_char_index_t cnt;
		for(cnt = FIELD_ID_CHAR_SENSOR_ID; cnt <= FIELD_ID_CHAR_FIRMWARE_REVISION; cnt++)
		{
				if(char_uuid == SENSOR_CHAR_UUIDS[cnt])
				{
						return (uint8_t)cnt;
				}
		}
		return 0xFF;
}
